@using AttandanceSyncApp.Models.AttandanceSync

@{
    ViewBag.Title = "Sign Up";
    Layout = "~/Views/Shared/_AuthLayout.cshtml";
}

<div class="auth-container">
    <div class="auth-card shadow">

        <div class="auth-header">
            <h2>Sign Up</h2>
            <p>Create your Attandance Sync account</p>
        </div>

        <div class="divider"><span>or</span></div>

        <!-- ✅ FORM ACTION FIXED -->
        <form method="post" action="@Url.Action("RegisterRequest","Auth")">

            <!-- ===== EMPLOYEE DROPDOWN ===== -->
            <div class="form-group">
                <label>Select Employee</label>

                <select id="empDropdown" name="EmployeeId" class="form-control" required>
                    <option value="">-- Select --</option>

                    @if (ViewBag.Employees != null)
                    {
                        foreach (var emp in ViewBag.Employees)
                        {
                            <option value="@emp.Id" data-email="@emp.Email">
                                @emp.Name
                            </option>
                        }
                    }
                </select>
            </div>

            <!-- ===== EMAIL DROPDOWN (NEW SYSTEM) ===== -->
            <div class="form-group">
                <label>Select Email</label>

                <select id="emailDropdown" name="Email" class="form-control" required>
                    <option value="">-- Select Email --</option>
                </select>
            </div>

            <!-- ===== COMPANY DROPDOWN ===== -->
            <div class="form-group">
                <label>Company Name</label>

                <select name="CompanyId" class="form-control" required>
                    <option value="">Select Company</option>

                    @foreach (var c in ViewBag.Companies)
                    {
                        <option value="@c.Id">@c.Name</option>
                    }
                </select>
            </div>

            <!-- ===== TOOL DROPDOWN ===== -->
            <div class="form-group">
                <label>Tool</label>

                <select name="ToolId" class="form-control" required>
                    <option value="">Select Tool</option>

                    @foreach (var t in ViewBag.Tools)
                    {
                        <option value="@t.Id">@t.Name</option>
                    }
                </select>
            </div>

            <button type="submit" class="btn btn-primary w-100">
                Create Account
            </button>

        </form>

        @if (TempData["msg"] != null)
        {
            <div class="alert alert-info mt-3">
                @TempData["msg"]
            </div>
        }

    </div>
</div>

<!-- ================= SCRIPT SECTION ================= -->
@section Scripts{
    <script>
        document.addEventListener("DOMContentLoaded", function () {

            var empDropdown = document.getElementById("empDropdown");
            var emailDropdown = document.getElementById("emailDropdown");

            if (!empDropdown || !emailDropdown) {
                console.log("Dropdown not found!");
                return;
            }

            empDropdown.addEventListener("change", function () {

                // আগের email clear
                emailDropdown.innerHTML =
                    '<option value="">-- Select Email --</option>';

                var selected = this.options[this.selectedIndex];

                var email = selected.getAttribute("data-email");

                console.log("Selected Email:", email);

                if (email) {
                    var opt = document.createElement("option");
                    opt.value = email;
                    opt.text = email;
                    opt.selected = true;

                    emailDropdown.appendChild(opt);
                }
            });

        });
    </script>
}
